Metadata-Version: 2.4
Name: emocon
Version: 0.1.0
Summary: Emotional Contagion Analysis for Reddit Comment Threads
Author: Ke Tian, Kaylee Cameron, Matthew Hakim, Yanmin Gui, Jiaheng Cao
License: MIT
Project-URL: Homepage, https://github.com/your-team/DSAN-5400-Final-Project
Project-URL: Bug Reports, https://github.com/your-team/DSAN-5400-Final-Project/issues
Project-URL: Source, https://github.com/your-team/DSAN-5400-Final-Project
Keywords: nlp,emotion,contagion,reddit,sentiment-analysis
Classifier: Development Status :: 3 - Alpha
Classifier: Intended Audience :: Science/Research
Classifier: License :: OSI Approved :: MIT License
Classifier: Programming Language :: Python :: 3
Classifier: Programming Language :: Python :: 3.8
Classifier: Programming Language :: Python :: 3.9
Classifier: Programming Language :: Python :: 3.10
Classifier: Programming Language :: Python :: 3.11
Classifier: Topic :: Scientific/Engineering :: Artificial Intelligence
Classifier: Topic :: Text Processing :: Linguistic
Requires-Python: >=3.8
Description-Content-Type: text/markdown
Requires-Dist: pandas>=1.5.0
Requires-Dist: numpy>=1.21.0
Requires-Dist: pyarrow>=10.0.0
Requires-Dist: networkx>=2.8.0
Requires-Dist: scipy>=1.9.0
Requires-Dist: matplotlib>=3.5.0
Requires-Dist: seaborn>=0.12.0
Requires-Dist: statsmodels>=0.13.0
Requires-Dist: click>=8.0.0
Requires-Dist: tqdm>=4.64.0
Provides-Extra: dev
Requires-Dist: pytest>=7.0.0; extra == "dev"
Requires-Dist: pytest-cov>=4.0.0; extra == "dev"
Requires-Dist: black>=22.0.0; extra == "dev"
Requires-Dist: flake8>=5.0.0; extra == "dev"
Requires-Dist: mypy>=0.991; extra == "dev"

# Emotional Contagion Analysis

**Team Members:** Kaylee Cameron, Jiaheng Cao, Matthew Hakim, Yanmin Gui, Ke Tian
**Course:** DSAN 5400 - Natural Language Processing
**Project:** Echo to Empathy - Detecting Emotional Contagion in Online Discussions

[![Python 3.8+](https://img.shields.io/badge/python-3.8+-blue.svg)](https://www.python.org/downloads/)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)

---

## Table of Contents

- [Overview](#overview)
- [Installation](#installation)
- [Quick Start](#quick-start)
- [CLI Usage](#cli-usage)
- [Project Structure](#project-structure)
- [Pipeline Stages](#pipeline-stages)

---

## Overview

A Python package for analyzing emotional contagion in Reddit comment threads. This project quantifies how different emotions propagate, evolve, and reinforce themselves within threaded conversations using the GoEmotions dataset.

### Key Features

- **Data Acquisition**: Automated download and preprocessing of Reddit comment data
- **Emotion Analysis**: Aggregation of fine-grained emotions into macro categories with valence scores
- **Contagion Modeling**: Statistical analysis of emotional propagation across thread depths
- **Visualization**: Publication-quality figures for emotional dynamics
- **CLI Interface**: Complete command-line interface for pipeline execution

### Deliverables

- 2,530 parent-child comment pairs for emotion propagation analysis
- 185 conversation threads with reply structures
- Complete data processing pipeline with logging and reproducibility
- Modular, installable Python package

---

## Installation

### Option 1: Install as Package (Recommended)

```bash
# Clone the repository
git clone <repository-url>
cd DSAN-5400-Final-Project

# Create conda environment
conda env create -f environment.yml
conda activate emocon

# Install package in editable mode
pip install -e .
```

### Option 2: Manual Setup

```bash
# Create virtual environment
python -m venv venv
source venv/bin/activate  # On Windows: venv\Scripts\activate

# Install dependencies
pip install pandas numpy pyarrow networkx scipy matplotlib seaborn statsmodels click tqdm

# Install package
pip install -e .
```

### Verify Installation

```bash
# Check package installation
emocon --version

# Display package info
emocon info
```

---

## Quick Start

### Using the CLI (Easiest)

Run the complete pipeline with a single command:

```bash
emocon analyze
```

This will:
1. Download the GoEmotions dataset
2. Preprocess and build thread graphs
3. Aggregate emotions into macro categories
4. Prepare the contagion analysis dataset
5. Run complete contagion analysis

### Using Python API

```python
from emocon import EmotionAggregator, RedditDataLoader
import pandas as pd

# Load data
df = pd.read_parquet("data/parent_child_pairs.parquet")

# Aggregate emotions
aggregator = EmotionAggregator(role="child")
results = aggregator.process_dataframe(df)

print(results.head())
```

---

## CLI Usage

The `emocon` command provides access to all pipeline stages:

### Download Dataset

```bash
emocon download
```

### Preprocess Data

```bash
emocon preprocess
```

### Aggregate Emotions

```bash
emocon aggregate-emotions
```

### Prepare Contagion Dataset

```bash
emocon prepare-contagion
```

### Full Pipeline

```bash
# Run everything
emocon analyze

# Skip download if data exists
emocon analyze --skip-download

# Skip preprocessing
emocon analyze --skip-preprocess
```

### Get Information

```bash
# Show package info and data file status
emocon info
```

---

## Project Structure

```
DSAN-5400-Final-Project/
├── src/emocon/              # Main package source code
│   ├── __init__.py          # Package initialization
│   ├── __main__.py          # Module execution entry point
│   ├── cli.py               # Command-line interface
│   ├── utils.py             # Logging and utilities
│   ├── data/                # Data acquisition & preprocessing
│   │   ├── loader.py        # Data loading from HuggingFace
│   │   ├── text_cleaner.py  # Text preprocessing
│   │   ├── thread_builder.py # Thread graph construction
│   │   └── pipeline.py      # Full data pipeline
│   ├── models/              # Emotion modeling
│   │   └── emotion_model.py # Emotion aggregation
│   ├── contagion/           # Contagion analysis
│   │   ├── model.py         # Data merging
│   │   ├── analysis.py      # Valence correlation analysis
│   │   ├── decay_model.py   # Depth-based decay modeling
│   │   ├── propogation_strength.py # Emotion propagation strength
│   │   ├── emotion_transitions.py  # Transition matrices
│   │   ├── significance_tests.py   # Statistical testing
│   │   └── outlier_analysis.py     # Outlier detection
│   └── visualization/       # Visualization tools
│       └── plotter.py       # Additional plotting functions
├── data/                    # Data files (generated)
│   ├── goemotions_local.csv
│   ├── parent_child_pairs.parquet
│   ├── emotion_scores_*.parquet
│   └── contagion_ready.parquet
├── results/                 # Analysis results (generated)
│   ├── contagion_stats.json
│   ├── emotion_propagation.json
│   ├── decay_stats.json
│   ├── emotion_transitions.json
│   ├── significance_stats.json
│   └── outlier_analysis.json
├── figures/                 # Generated visualizations
│   ├── emotion_propagation_strength.png
│   ├── decay_curve.png
│   └── emotion_transitions_heatmap.png
├── tests/                   # Test files
│   └── test_pipeline.py     # End-to-end tests
├── examples/                # Example scripts
│   ├── download_data.py     # Download dataset
│   ├── run_emotion_aggregation.py # Emotion aggregation example
│   ├── run_aggregator_test.py     # Quick test
│   └── check_emotion_scores.py    # Verify results
├── scripts/                 # Development scripts
│   └── verify_package.py    # Package verification
├── logs/                    # Execution logs
├── pyproject.toml           # Package configuration
├── environment.yml          # Conda environment
└── README.md                # This file
```

---

## Pipeline Stages

The `emocon analyze` command executes a complete 5-stage pipeline:

### Stage 1: Data Acquisition (Member 1)
**Component:** Data loading and initial preprocessing
**Author:** Ke Tian

- Downloads GoEmotions dataset from HuggingFace
- Saves to `data/goemotions_local.csv` (40.76 MB)
- Contains Reddit comments with 28 fine-grained emotion labels

**Key files:**
- `src/emocon/data/loader.py`

### Stage 2: Data Preprocessing (Member 1)
**Component:** Thread construction and pair extraction
**Author:** Ke Tian

- Builds conversation thread graphs using NetworkX
- Extracts parent-child comment pairs
- Performs text cleaning and normalization
- Outputs:
  - `data/threads_with_replies.parquet` (185 threads)
  - `data/parent_child_pairs.parquet` (2,530 pairs)

**Key files:**
- `src/emocon/data/text_cleaner.py`
- `src/emocon/data/thread_builder.py`
- `src/emocon/data/pipeline.py`

### Stage 3: Emotion Aggregation (Member 2)
**Component:** Emotion label aggregation and valence computation
**Author:** Jiaheng Cao

Transforms fine-grained GoEmotions (28 labels) into:
1. **Macro emotion categories**: joy, anger, sadness, fear, neutral/other
2. **Continuous valence scores**: [-1.0, 1.0] range

**Outputs:**
- `data/emotion_scores_child.parquet`
- `data/emotion_scores_parent.parquet`

Each file contains:
| Column | Example | Description |
|--------|---------|-------------|
| `comment_id` | `ed1gxcf` | Reddit comment ID |
| `macro_label` | `joy` | Aggregated emotion |
| `valence` | `0.75` | Emotional intensity |

**Key files:**
- `src/emocon/models/emotion_model.py`

**Usage examples:**
```bash
# Via CLI
emocon aggregate-emotions

# Via Python
from emocon import EmotionAggregator
aggregator = EmotionAggregator(role="child")
results = aggregator.process_dataframe(df)
```

### Stage 4: Contagion Dataset Preparation (Member 3)
**Component:** Data merging and contagion-ready dataset construction
**Author:** Kaylee Cameron

Merges parent-child pairs with emotion scores and depth information to create the final analysis dataset.

**Output:**
- `data/contagion_ready.parquet` (2,530 rows with parent/child emotions and depths)

**Key files:**
- `src/emocon/contagion/model.py`

### Stage 5: Emotional Contagion Analysis (Member 3)
**Component:** Statistical analysis of emotional propagation
**Author:** Kaylee Cameron

Comprehensive analysis of how emotions transfer from parent to child comments:

#### 5.1 Valence Correlation Analysis
Quantifies parent-child emotional alignment:
- Pearson correlation (linear relationship)
- Spearman correlation (monotonic relationship)
- Output: `results/contagion_stats.json`

#### 5.2 Emotion Propagation Strength
Ranks emotions by contagion strength:
- Computes: P(child = same emotion | parent emotion) - baseline
- Identifies which emotions propagate most strongly
- Outputs:
  - `results/emotion_propagation.json`
  - `results/emotion_propagation.csv`
  - `figures/emotion_propagation_strength.png`

#### 5.3 Depth-Based Decay Analysis
Models how emotional matching decays with thread depth:
- Computes P(emotion match | depth)
- Simple slope estimation for decay rate
- Outputs:
  - `results/decay_stats.json`
  - `figures/decay_curve.png`

#### 5.4 Emotion Transition Matrices
Full transition probability matrices showing emotion shifts:
- Transition counts and probabilities
- Heatmap visualization
- Outputs:
  - `results/emotion_transitions.json`
  - `figures/emotion_transitions_heatmap.png`

#### 5.5 Statistical Significance Testing
Formal hypothesis testing:
- Chi-square test for independence (parent vs child emotion)
- Depth-based significance tests (z-tests comparing depths)
- Output: `results/significance_stats.json`

#### 5.6 Outlier Thread Detection
Identifies threads with unusually strong emotional propagation:
- Parent-level aggregation of contagion strength
- Statistical outlier detection
- Output: `results/outlier_analysis.json`

**Key files:**
- `src/emocon/contagion/analysis.py` - Valence correlation
- `src/emocon/contagion/propogation_strength.py` - Propagation ranking
- `src/emocon/contagion/decay_model.py` - Decay analysis
- `src/emocon/contagion/emotion_transitions.py` - Transition matrices
- `src/emocon/contagion/significance_tests.py` - Statistical tests
- `src/emocon/contagion/outlier_analysis.py` - Outlier detection

---

## Team Contributions

### Member 1: Data Engineering (Ke Tian)
- Data acquisition pipeline (HuggingFace integration)
- Thread graph construction with NetworkX
- Parent-child pair extraction
- Text preprocessing and cleaning

### Member 2: Emotion Modeling (Jiaheng Cao)
- GoEmotions label aggregation
- Macro emotion categorization
- Valence score computation
- Emotion model implementation

### Member 3: Contagion Analysis (Kaylee Cameron)
- Statistical contagion modeling
- Decay analysis and depth effects
- Transition matrix analysis
- Significance testing and outlier detection

### Member 4: Software Architecture (Yanmin Gui)
- Package structure and organization
- CLI development (Click framework)
- Integration of all pipeline stages
- Documentation and testing

### Member 5: Visualization (Matthew Hakim)
- Additional visualization functions
- Publication-quality figure generation
- Dashboard and summary plots
- Extension point: `src/emocon/visualization/plotter.py`

---

## License

MIT License - See LICENSE file for details

